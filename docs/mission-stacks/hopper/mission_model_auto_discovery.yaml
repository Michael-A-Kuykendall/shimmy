mission:
  name: "Model Auto-Discovery System"
  description: "Scan common model directories, detect GGUF files, auto-populate registry"
  priority: "HIGH"
  estimated_effort: "1-2 days"
  value_proposition: "Zero-configuration operation - shimmy finds models automatically"

epics:
  - name: "Filesystem Scanner"
    description: "Implement filesystem scanning for GGUF files"
    gates:
      - "Scans common model directories (./models, ~/.cache/huggingface, etc.)"
      - "Detects .gguf files recursively"
      - "Extracts model metadata from filename patterns"
    steps:
      - step_type: "command"
        description: "Create discovery module"
        command: "touch"
        args: ["src/auto_discovery.rs"]
      - step_type: "command"
        description: "Add module to lib.rs"
        command: "echo"
        args: ["pub mod auto_discovery;", ">>", "src/lib.rs"]

  - name: "Model Metadata Extraction"
    description: "Extract model information from filenames and file headers"
    dependencies: ["Filesystem Scanner"]
    gates:
      - "Parses model names from filenames (llama-3.2-3b-instruct-q4_k_m.gguf)"
      - "Detects parameter counts and quantization levels"
      - "Identifies instruction-tuned vs base models"
    steps:
      - step_type: "command"
        description: "Test metadata extraction"
        command: "cargo"
        args: ["test", "--features", "llama", "auto_discovery"]

  - name: "Registry Integration"
    description: "Auto-populate model registry with discovered models"
    dependencies: ["Model Metadata Extraction"]
    gates:
      - "Discovered models appear in /api/tags response"
      - "Models can be loaded without manual configuration"
      - "Registry persists discovered models between restarts"
    steps:
      - step_type: "command"
        description: "Update registry to support auto-discovery"
        command: "sed"
        args: ["-i", "s|// TODO: auto-discovery|self.auto_discover().await?;|", "src/model_registry.rs"]

  - name: "CLI Integration"
    description: "Add discovery commands to CLI"
    dependencies: ["Registry Integration"]
    gates:
      - "shimmy discover command scans and reports found models"
      - "shimmy list shows auto-discovered models"
      - "Discovery can be disabled with --no-auto-discover flag"
    steps:
      - step_type: "command"
        description: "Test CLI discovery"
        command: "cargo"
        args: ["run", "--features", "llama", "--", "discover"]

verification:
  build_tests:
    - "cargo build --features llama"
    - "cargo test --features llama auto_discovery"
  
  functional_tests:
    - "Place test .gguf file in ./models/ directory"
    - "Start shimmy server"
    - "Verify model appears in /api/tags without configuration"
    - "Test generation with auto-discovered model"

  integration_tests:
    - "Test with multiple models in different directories"
    - "Test with unusual filename patterns"
    - "Verify graceful handling of corrupted GGUF files"

completion_criteria:
  - "Build passes with no warnings"
  - "Auto-discovery finds models in common locations"
  - "Models can be loaded and used without manual config"
  - "CLI commands work for discovery"
  - "Performance: discovery completes in < 5 seconds"

success_metrics:
  - "Zero-config startup for users with existing model files"
  - "Discovery finds 95%+ of properly named GGUF files"
  - "Startup time increase < 2 seconds with discovery"
